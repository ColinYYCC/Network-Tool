/**
 * @Sub-Store-Page
 * CNAME æ¥å£æŸ¥è¯¢å»é‡/é‡å‘½å 2026-01-24
 * - å…¥å£æŸ¥è¯¢[å›½å†…spapi è¯†åˆ«åˆ°å›½å¤–ä¸ºip-api] è½åœ°æŸ¥è¯¢[ip-api]
 * - æ ¹æ®æ¥å£è¿”å›çš„çœŸå®ç»“æœï¼Œé‡æ–°å¯¹èŠ‚ç‚¹å‘½åã€‚
 * - æ·»åŠ å…¥å£åŸå¸‚ã€è½åœ°å›½å®¶æˆ–åœ°åŒºã€å›½å†…è¿è¥å•†ä¿¡æ¯ï¼Œå¹¶å¯¹è¿™äº›æ•°æ®åšæŒä¹…åŒ–ç¼“å­˜ï¼ˆ48å°æ—¶æœ‰æ•ˆæœŸï¼‰ï¼Œå‡å°‘APIè¯·æ±‚æ¬¡æ•°ï¼Œæé«˜è¿è¡Œæ•ˆç‡ã€‚
 * - ä»…å…¼å®¹ Surge, Loon å®¢æˆ·ç«¯ã€‚
 * - Surge éœ€è¦å›ºå®šå¸¦ ability å‚æ•°ç‰ˆæœ¬ã€‚
 * ç‰¹åˆ«è¯´æ˜ï¼š
 * - ç¬¦å·ï¼šğŸ…³ç”µä¿¡ ğŸ…»è”é€š ğŸ†ˆç§»åŠ¨ ğŸ…¶å¹¿ç”µ ğŸ…²å…¬å¸ ğŸ†‰ç›´è¿ ğŸ®æ¸¸æˆ
 * - é¦–æ¬¡è¿è¡Œæˆ–è€…åœ¨æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ä¼šé€šçŸ¥è¿›åº¦
 * - æ— å‚æ•°æ—¶çš„èŠ‚ç‚¹å‘½åæ ¼å¼: "ç¾å›½ 01"
 * - 1. å®˜æ–¹é»˜è®¤ç‰ˆ(ç›®å‰ä¸å¸¦ ability å‚æ•°, ä¸ä¿è¯ä»¥åä¸ä¼šæ”¹åŠ¨): ã€‹https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Surge.sgmodule
 *
 * - 2. å›ºå®šå¸¦ ability å‚æ•°ç‰ˆæœ¬,å¯èƒ½ä¼šçˆ†å†…å­˜, å¦‚æœéœ€è¦ä½¿ç”¨æŒ‡å®šèŠ‚ç‚¹åŠŸèƒ½ ä¾‹å¦‚ [åŠ å›½æ——è„šæœ¬æˆ–è€…cnameè„šæœ¬] è¯·ä½¿ç”¨æ­¤å¸¦ ability å‚æ•°ç‰ˆæœ¬: https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Surge-ability.sgmodule
 *
 * - 3. å›ºå®šä¸å¸¦ ability å‚æ•°ç‰ˆæœ¬ï¼šhttps://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Surge-Noability.sgmodule
 *
 * - å‚æ•°å¿…é¡»ä»¥"#"å¼€å¤´ï¼Œå¤šä¸ªå‚æ•°ä½¿ç”¨"&"è¿æ¥ï¼Œä¾‹å¦‚ https://github.com/Keywos/rule/raw/main/cname.js#city&iisp&name=Name
 * - ä»¥ä¸‹æ˜¯æ­¤è„šæœ¬æ”¯æŒçš„å‚æ•°ï¼Œå¿…é¡»ä»¥"#"å¼€å¤´ï¼Œå¤šä¸ªå‚æ•°ä½¿ç”¨"&"è¿æ¥ï¼Œéœ€è¦ä¼ å…¥å‚æ•°çš„è¯ç”¨ "=" ä¾‹å¦‚ "name=ä¸€å…ƒ" å‚è€ƒä¸Šè¿°åœ°å€ä¸ºä¾‹ä½¿ç”¨å‚æ•°ã€‚
 * - æ— å‚æ•°æ—¶çš„èŠ‚ç‚¹å‘½åæ ¼å¼: "ç¾å›½ 01"ï¼Œå¦‚æœ [å…¥å£IPæˆ–å›½å®¶]æˆ– [è½åœ°IPæˆ–å›½å®¶]ä¸€æ ·åˆ™ä¸º "ç›´è¿ å¾·å›½ 01" 
 * - é¦–æ¬¡è¿è¡Œæˆ–è€…åœ¨æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ä¼šé€šçŸ¥è¿›åº¦
 * 
 * 
 * å…¥å£å‚æ•°
 * - [iisp]      å¢åŠ å…¥å£è¿è¥å•†æˆ–è€…ç›´è¿æ ‡è¯†ï¼›
 * - [city]      å¢åŠ å…¥å£åŸå¸‚æ–‡å­—æ ‡è¯†ï¼›
 * - [sheng]     å¢åŠ å…¥å£çœä»½æ–‡å­—æ ‡è¯†ï¼›
 * - [yuan]      ä¸ºå¢ƒå¤–å…¥å£æ·»åŠ çœŸå®çš„å…¥å£å±åœ°æ ‡è¯†ï¼Œå½“æœªé…ç½®æ­¤æ­¤å‚æ•°æ—¶ï¼Œåˆ™å°†å¢ƒå¤–å…¥å£ç»Ÿä¸€æ ‡è®°ä¸º [å¢ƒå¤–]ï¼Œé»˜è®¤æœªé…ç½®æ­¤å‚æ•°ï¼›
 * - [inflag]    å¢åŠ å…¥å£å›½æ——
 * 
 * è½åœ°å‚æ•°
 * - [yisp]      æ˜¾ç¤ºè½åœ°è¯¦ç»†è¿è¥å•†åç§°ï¼›
 * - [yw]        è½åœ°å½’å±åœ°ä½¿ç”¨è‹±æ–‡ç¼©å†™æ ‡è¯†ï¼Œä¸å»ºè®®ä¸å…¶ä»–å…¥å£å‚æ•°é…åˆä½¿ç”¨ï¼Œå› ä¸ºå…¶ä»–å‚æ•°APIæ²¡æœ‰è¿”å›è‹±æ–‡ï¼›
 * - [xy]        æ­¤å‚æ•°å…³é—­è½åœ°æŸ¥è¯¢ï¼Œä»…æŸ¥è¯¢å…¥å£ï¼›å¼€å¯ yisp || yw || flag å‚æ•°å xy å‚æ•°æ— æ•ˆ
 * 
 * å›¾æ ‡å‚æ•°
 * - [game]      å¢åŠ æ¸¸æˆèŠ‚ç‚¹æ ‡è¯†ï¼›
 * - [flag]      å¢åŠ å›½å®¶æˆ–åœ°åŒºçš„æ——å¸œæ ‡è¯†ï¼Œé»˜è®¤æ— æ­¤å‚æ•°ï¼›
 * - [bl]        ä¿ç•™å€ç‡æ ‡è¯†ï¼›
 * - [snone]     æ¸…ç†æŸåœ°åŒºå†…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„åºå·ï¼›
 * 
 * åˆ†éš”ç¬¦å‚æ•°
 * - [fgf=]      è®¾ç½®å…¥å£å’Œè½åœ°ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼ï¼›
 * - [sn=]       è®¾ç½®å›½å®¶ä¸åºå·ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼ï¼›
 * - [name=]     ä¸ºèŠ‚ç‚¹æ·»åŠ æœºåœºåç§°å‰ç¼€ï¼›
 * 
 * é€šçŸ¥å‚æ•°
 * - [offtz]     å…³é—­è„šæœ¬é€šçŸ¥ï¼›
 * 
 * è§£æå‚æ•°
 * - [dnsjx]     å°†èŠ‚ç‚¹åŸŸåè§£æä¸ºIPï¼Œæ™®é€šç”¨æˆ·ä¸å»ºè®®ä½¿ç”¨ï¼›
 * 
 * é€»è¾‘å‚æ•°
 * - [bs=]       æ‰¹å¤„ç†èŠ‚ç‚¹æ•°å»ºè®®10ä¸ªå·¦å³ï¼Œå¦‚æœç»å¸¸è¯»ä¸åˆ°èŠ‚ç‚¹å»ºè®®å‡å°æ‰¹å¤„ç†ä¸ªæ•°ï¼›
 * 
 * ç¼“å­˜å‚æ•°
 * - [h=]        èŠ‚ç‚¹ç¼“å­˜æœ‰æ•ˆæœŸï¼Œå•ä½å°æ—¶ï¼Œæ—¶é—´å‚æ•°åªèƒ½äºŒé€‰ä¸€ï¼ŒLoonç”¨æˆ·ä¸éœ€å¡«å†™è¦æ­¤å‚æ•°ï¼Œè¯·è¿›å…¥Sub-Storeæ’ä»¶çš„é…ç½®ç•Œé¢è‡ªå®šä¹‰ç¼“å­˜æœ‰æ•ˆæœŸï¼›
 * - [min=]      èŠ‚ç‚¹ç¼“å­˜æœ‰æ•ˆæœŸï¼Œå•ä½åˆ†é’Ÿï¼Œæ—¶é—´å‚æ•°åªèƒ½äºŒé€‰ä¸€ï¼ŒLoonç”¨æˆ·ä¸éœ€å¡«å†™è¦æ­¤å‚æ•°ï¼Œè¯·è¿›å…¥Sub-Storeæ’ä»¶çš„é…ç½®ç•Œé¢è‡ªå®šä¹‰ç¼“å­˜æœ‰æ•ˆæœŸï¼›
 * 
 * è¶…æ—¶å‚æ•°
 * - [timeout=]  å½“æ— ä»»ä½•èŠ‚ç‚¹ç¼“å­˜æ—¶æµ‹è¯•èŠ‚ç‚¹HTTPå»¶æ—¶å…è®¸çš„æœ€å¤§è¶…æ—¶å‚æ•°ï¼Œè¶…å‡ºå…è®¸èŒƒå›´åˆ™åˆ¤å®šä¸ºæ— æ•ˆèŠ‚ç‚¹ï¼Œé»˜è®¤2000msï¼›
 * - [cd=]       å½“æœ‰ç¼“å­˜æ—¶ï¼Œä¼šå…ˆè¯»å–ç¼“å­˜ï¼Œç›´æ¥è¾“å‡ºç»“æœï¼›é»˜è®¤ [cd=]çš„å€¼ç­‰äº0ï¼Œå¾®ç›´æ¥è¯»å–ç¼“å­˜ï¼› 
 * å½“è®¾ä¸ºæ›´é«˜çš„å€¼: æ¯”å¦‚'460'åˆ™æ¯æ¬¡è¯»ç¼“å­˜éƒ½ä¼šå†æ¬¡å¤„ç†ä¹‹å‰åˆ¤å®šä¸ºè¶…æ—¶çš„èŠ‚ç‚¹,è¶…æ—¶ä¸º460ms
 *
 * å…¶ä»–å‚æ•°
 * - [debug]     è°ƒè¯•æ—¥å¿—ï¼Œæ™®é€šç”¨æˆ·ä¸å»ºè®®ä½¿ç”¨ã€‚
 * - å¼‚å¸¸ï¼šå¦‚é‡é—®é¢˜ï¼ŒLoonå¯ä»¥è¿›å…¥[é…ç½®]â†’[æŒä¹…åŒ–ç¼“å­˜]â†’[åˆ é™¤æŒ‡å®šæ•°æ®]â†’è¾“å…¥Key [sub-store-cached-script-resource]å¹¶åˆ é™¤ç¼“å­˜ã€‚ç´¯è®¡è¾“å‡ºèŠ‚ç‚¹ä¸º0ä¸ª3æ¬¡ä»¥ä¸Šå°†æ¸…ç†æ‰€æœ‰ç¼“å­˜
 * - Surgeéœ€è¦è¿›å…¥[è„šæœ¬ç¼–è¾‘å™¨]â†’å·¦ä¸‹è§’[è®¾ç½®]â†’[$persistentStore]  [sub-store-cached-script-resource]åˆ é™¤ç¼“å­˜æ•°æ®ã€‚
 */

const SUB_STORE_SCHEMA = {
  title: "CNAME",
  description: "æ ¹æ®æ¥å£è¿”å›çš„çœŸå®ç»“æœï¼Œé‡æ–°å¯¹èŠ‚ç‚¹å‘½å/å»é‡ã€‚ å¦‚ï¼šå…¥å£/è½åœ°è¯¦ç»†åœ°åŒºä¿¡æ¯",
  scope: ["Surge", "Loon"],
  author: "@Key @å¥¶èŒ¶å§ @å°ä¸€ @å¯è‰",
  updateTime: "2026-01-24 18:00:00",
  version: "3.0.0",
  params: {
    flag: {
      datatype: "boolean",
      description: "å¢åŠ è½åœ°å›½å®¶æˆ–åœ°åŒºçš„æ——å¸œæ ‡è¯†ï¼Œé»˜è®¤æ— æ­¤å‚æ•°",
      defaultValue: false,
    },
    inflag: {
      datatype: "boolean",
      description: "å¢åŠ å…¥å£å›½å®¶æˆ–åœ°åŒºçš„æ——å¸œæ ‡è¯†ï¼Œé»˜è®¤æ— æ­¤å‚æ•°",
      defaultValue: false,
    },
    xy: {
      datatype: "boolean",
      description: "å…³é—­è½åœ°æŸ¥è¯¢ï¼Œä»…æŸ¥è¯¢å…¥å£ï¼›å¼€å¯ yisp || yw || flag å‚æ•°å xy å‚æ•°æ— æ•ˆ",
      defaultValue: false,
    },
    iisp: {
      datatype: "boolean",
      description: "å¢åŠ å…¥å£è¿è¥å•†æˆ–è€…ç›´è¿æ ‡è¯†",
      defaultValue: false,
    },
    city: {
      datatype: "boolean",
      description: "å¢åŠ å…¥å£åŸå¸‚æ–‡å­—æ ‡è¯†",
      defaultValue: false,
    },
    sheng: {
      datatype: "boolean",
      description: "å¢åŠ å…¥å£çœä»½æ–‡å­—æ ‡è¯†",
      defaultValue: false,
    },
    yuan: {
      datatype: "boolean",
      description:
        "ä¸ºå¢ƒå¤–å…¥å£æ·»åŠ çœŸå®çš„å…¥å£å±åœ°æ ‡è¯†ï¼Œå½“æœªé…ç½®æ­¤æ­¤å‚æ•°æ—¶ï¼Œåˆ™å°†å¢ƒå¤–å…¥å£ç»Ÿä¸€æ ‡è®°ä¸º[å¢ƒå¤–]ï¼Œé»˜è®¤æœªé…ç½®æ­¤å‚æ•°",
      defaultValue: false,
    },
    yisp: {
      datatype: "boolean",
      description: "æ˜¾ç¤ºè½åœ°è¯¦ç»†è¿è¥å•†åç§°",
      defaultValue: false,
    },
    yw: {
      datatype: "boolean",
      description:
        "è½åœ°å½’å±åœ°ä½¿ç”¨è‹±æ–‡ç¼©å†™æ ‡è¯†ï¼Œä¸å»ºè®®ä¸å…¶ä»–å…¥å£å‚æ•°é…åˆä½¿ç”¨ï¼Œå› ä¸ºå…¶ä»–å‚æ•°APIæ²¡æœ‰è¿”å›è‹±æ–‡",
      defaultValue: false,
    },
    game: {
      datatype: "boolean",
      description: "å¢åŠ æ¸¸æˆèŠ‚ç‚¹æ ‡è¯†",
      defaultValue: false,
    },
    bl: {
      datatype: "boolean",
      description: "ä¿ç•™å€ç‡æ ‡è¯†",
      defaultValue: false,
    },
    snone: {
      datatype: "boolean",
      description: "æ¸…ç†æŸåœ°åŒºå†…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„åºå·",
      defaultValue: false,
    },
    offtz: {
      datatype: "boolean",
      description: "å…³é—­è„šæœ¬é€šçŸ¥",
      defaultValue: false,
    },
    dnsjx: {
      datatype: "boolean",
      description: "å°†èŠ‚ç‚¹åŸŸåè§£æä¸ºIP, æ™®é€šç”¨æˆ·ä¸å»ºè®®ä½¿ç”¨",
      defaultValue: false,
    },
    debug: {
      datatype: "boolean",
      description: "è°ƒè¯•æ—¥å¿—ï¼Œæ™®é€šç”¨æˆ·ä¸å»ºè®®ä½¿ç”¨",
      defaultValue: false,
    },
    fgf: {
      datatype: "string",
      description: "è®¾ç½®å…¥å£å’Œè½åœ°ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼",
      defaultValue: " ",
    },
    sn: {
      datatype: "string",
      description: "è®¾ç½®å›½å®¶ä¸åºå·ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼",
      defaultValue: " ",
    },
    name: {
      datatype: "string",
      description: "ä¸ºèŠ‚ç‚¹æ·»åŠ æœºåœºåç§°å‰ç¼€",
      defaultValue: "",
    },
    timeout: {
      datatype: "number",
      description:
        "å½“æ— ä»»ä½•èŠ‚ç‚¹ç¼“å­˜æ—¶æµ‹è¯•èŠ‚ç‚¹HTTPå»¶æ—¶å…è®¸çš„æœ€å¤§è¶…æ—¶å‚æ•°ï¼Œè¶…å‡ºå…è®¸èŒƒå›´åˆ™åˆ¤å®šä¸ºæ— æ•ˆèŠ‚ç‚¹ï¼Œé»˜è®¤2000ms",
      defaultValue: 2000,
    },
    cd: {
      datatype: "number",
      description:
        "å½“æœ‰ç¼“å­˜æ—¶ï¼Œä¼šå…ˆè¯»å–ç¼“å­˜ï¼Œç›´æ¥è¾“å‡ºç»“æœï¼›é»˜è®¤[cd=]çš„å€¼ç­‰äº0ï¼Œå¾®ç›´æ¥è¯»å–ç¼“å­˜ï¼› å½“è®¾ä¸ºæ›´é«˜çš„å€¼: æ¯”å¦‚'460'åˆ™æ¯æ¬¡è¯»ç¼“å­˜éƒ½ä¼šå†æ¬¡å¤„ç†ä¹‹å‰åˆ¤å®šä¸ºè¶…æ—¶çš„èŠ‚ç‚¹,è¶…æ—¶ä¸º460ms",
      defaultValue: 0,
    },
    bs: {
      datatype: "number",
      description:
        "æ‰¹å¤„ç†èŠ‚ç‚¹æ•°å»ºè®®10ä¸ªå·¦å³ï¼Œå¦‚æœç»å¸¸è¯»ä¸åˆ°èŠ‚ç‚¹å»ºè®®å‡å°æ‰¹å¤„ç†ä¸ªæ•°",
      defaultValue: 10,
    },
    h: {
      datatype: "number",
      description:
        "èŠ‚ç‚¹ç¼“å­˜æœ‰æ•ˆæœŸï¼Œå•ä½å°æ—¶ï¼Œæ—¶é—´å‚æ•°åªèƒ½äºŒé€‰ä¸€ï¼ŒLoonç”¨æˆ·ä¸éœ€å¡«å†™è¦æ­¤å‚æ•°ï¼Œè¯·è¿›å…¥Sub-Storeæ’ä»¶çš„é…ç½®ç•Œé¢è‡ªå®šä¹‰ç¼“å­˜æœ‰æ•ˆæœŸ",
      defaultValue: "",
    },
    min: {
      datatype: "number",
      description:
        "èŠ‚ç‚¹ç¼“å­˜æœ‰æ•ˆæœŸï¼Œå•ä½åˆ†é’Ÿï¼Œæ—¶é—´å‚æ•°åªèƒ½äºŒé€‰ä¸€ï¼ŒLoonç”¨æˆ·ä¸éœ€å¡«å†™è¦æ­¤å‚æ•°ï¼Œè¯·è¿›å…¥Sub-Storeæ’ä»¶çš„é…ç½®ç•Œé¢è‡ªå®šä¹‰ç¼“å­˜æœ‰æ•ˆæœŸ",
      defaultValue: "",
    },
  },
};

const $ = $substore;
const iar = $arguments;
let debug = iar.debug;
const { yw, bl, iisp, xy, yisp, city, flag, inflag, game, yuan, sheng, offtz, snone: numone } = iar;
const h = iar.h ? decodeURI(iar.h) : "", min = iar.min ? decodeURI(iar.min) : "", firstN = iar.name ? decodeURI(iar.name) : "";
const { isLoon, isSurge } = $substore.env;
const dns = iar.dnsjx;
const target = isLoon ? "Loon" : isSurge ? "Surge" : undefined;
const keypr = "peedtest";
let cd = iar.cd ? iar.cd : 0, timeout = iar.timeout ? iar.timeout : 2000;
let innum = 1728e5, loontrue = false, onen = false, Sue = false, rawtime = 1500;
const keyp = "3.s", EXPIRATION_KEY = "#sub-store-csr-expiration-time";

if (min !== "") {
  Sue = true;
  innum = parseInt(min, 10) * 6e4;
  $.write(JSON.stringify(innum), EXPIRATION_KEY);
} else if (h !== "") {
  Sue = true;
  innum = parseInt(h, 10) * 36e5;
  $.write(JSON.stringify(innum), EXPIRATION_KEY);
} else {
  $.write(JSON.stringify(innum), EXPIRATION_KEY);
}

let TIMEDKEY = $.read(EXPIRATION_KEY), inapi = 0;

// é…ç½®å¸¸é‡
const CONFIG = {
  BATCH_SIZE: iar.bs || 10,
  TIMEOUT: timeout,
  CACHE_TIMEOUT: cd,
  RETRY_MAX: 2,
  CACHE_KEY_PREFIX: {
    ALI: "al",
    SP: "sc",
    IN: "in",
    OUT: "out"
  }
};

// ç¼“å­˜æ˜ å°„è¡¨
const CACHE_MAPS = {
  alMap: new Map(),
  spMap: new Map(),
  iaMap: new Map(),
  oaMap: new Map()
};

// APIç»Ÿè®¡
let apiStats = {
  read: 0,
  write: 0
};

/**
 * ä¸»å‡½æ•°å…¥å£
 */
async function operator(e = [], env) {
  const startTime = new Date();
  const support = isLoon || isSurge;
  
  // åˆå§‹åŒ–å˜é‡
  let tzname = "", subcoll = "", x = false, xys = false;
  if (env?.source?.[e?.[0]?.subName]) x = true;
  if (env?.source?._collection?.name) xys = true;
  
  // ç¡®å®šè®¢é˜…ä¿¡æ¯
  if (x && xys) {
    tzname = env.source._collection.name + ": [" + env.source._collection.subscriptions + "]";
    subcoll = "ç»„åˆè®¢é˜…å†…å•æ¡è®¢é˜…åŠ äº†è„šæœ¬, è¾“å‡ºç»„åˆè®¢é˜…";
  } else if (x) {
    tzname = env.source[e[0].subName].name;
    subcoll = "å•æ¡è®¢é˜…è„šæœ¬";
  } else {
    tzname = env.source._collection.name;
    subcoll = "ç»„åˆè®¢é˜…è„šæœ¬";
  }
  
  // æ—¥å¿—å‡½æ•°
  function klog(...arg) {
    console.log('[CNAME] ' + subcoll + tzname + " : " + arg);
  }
  
  // æ£€æŸ¥èŠ‚ç‚¹æ•°é‡
  if (e.length < 1) {
    $.notify(subcoll + tzname, "è®¢é˜…æ— èŠ‚ç‚¹", "");
    return e;
  }
  
  // æ£€æŸ¥ç¼“å­˜æ˜¯å¦å¯ç”¨
  if (typeof scriptResourceCache === "undefined") return e;
  
  const ein = e.length;
  const eins = ein / 2;
  
  klog(`å¼€å§‹å¤„ç†èŠ‚ç‚¹: ${ein} ä¸ª`);
  klog(`æ‰¹å¤„ç†èŠ‚ç‚¹æ•°: ${CONFIG.BATCH_SIZE} ä¸ª`);
  klog(`è®¾å®šapiè¶…æ—¶: ${zhTime(timeout)}`);
  klog(`æœ‰ç¼“apiè¶…æ—¶: ${zhTime(cd)}`);
  
  // æ£€æŸ¥ç¼“å­˜æ•°é‡
  let cachen = 0;
  for (const pk of e) {
    const id = getid(pk);
    if (scriptResourceCache.get(id)) {
      cachen++;
      if (cachen > eins && !onen) {
        klog(`æ£€æŸ¥ç¼“å­˜æ•°é‡: ${cachen}/${ein} ä¸ª`);
        rawtime = timeout;
        timeout = cd;
        onen = true;
        break;
      }
    }
  }
  
  // æ˜¾ç¤ºé€šçŸ¥
  if (!onen && !offtz) {
    $.notify(subcoll + tzname, `å¼€å§‹å¤„ç†èŠ‚ç‚¹: ${ein} ä¸ª æ‰¹å¤„ç†æ•°é‡: ${CONFIG.BATCH_SIZE} ä¸ª`, "è¯·ç­‰å¾…å¤„ç†å®Œæ¯•åå†æ¬¡ç‚¹å‡»é¢„è§ˆ");
  }
  
  // é‡è¯•é€»è¾‘
  let retryi = 0, breaki = false;
  do {
    const processedNodes = await processNodesBatch(e, CONFIG.BATCH_SIZE, klog, subcoll, tzname);
    
    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹è½åœ°IPç›¸åŒ
    if (processedNodes.length > 3 && isSurge) {
      const allsame = processedNodes.every((value, index, arr) => value._outips === arr[0]._outips);
      if (allsame) {
        klog(`æœªä½¿ç”¨å¸¦æŒ‡å®šèŠ‚ç‚¹åŠŸèƒ½çš„ SubStore, æˆ–æ‰€æœ‰èŠ‚ç‚¹è½åœ°IPç›¸åŒ`);
        $.notify('CNAMEï¼šç‚¹å‡»ä»¥å®‰è£…å¯¹åº”ç‰ˆæœ¬', 'æœªä½¿ç”¨å¸¦æŒ‡å®šèŠ‚ç‚¹åŠŸèƒ½çš„ SubStoreï¼Œæˆ–æ‰€æœ‰èŠ‚ç‚¹è½åœ°IPç›¸åŒ', '', {
          url: "https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Surge-ability.sgmodule",
        });
        return processedNodes;
      }
    }
    
    // ç§»é™¤é‡å¤èŠ‚ç‚¹ï¼ˆåŸºäºqcå±æ€§ï¼‰
    !xy && (e = removels(e));
    
    // å¤„ç†é‡è¯•
    if (inapi >= 1) {
      retryi++;
      timeout = rawtime;
      onen = false;
      // æ¸…ç©ºç¼“å­˜æ˜ å°„
      Object.values(CACHE_MAPS).forEach(map => map.clear());
      klog(`é‡è¯•ä¸­...`);
    } else {
      retryi = 2;
    }
  } while (retryi < 2);
  
  // æœ€ç»ˆå¤„ç†
  !xy && (e = removeqc(e));
  e = jxh(e);
  numone && (e = onee(e));
  
  const endTime = new Date();
  const timeDiff = endTime.getTime() - startTime.getTime();
  const eout = e.length;
  
  // è¾“å‡ºæ—¥å¿—
  if (dns) klog(`dnsè§£æåå…±: ${eout} ä¸ª`);
  apiStats.read > 0 && klog(`è¯»å–apiç¼“å­˜: ${apiStats.read} ä¸ª`);
  apiStats.write > 0 && klog(`å†™å…¥apiç¼“å­˜: ${apiStats.write} ä¸ª`);
  klog(`å¤„ç†å®Œåå‰©ä½™: ${eout} ä¸ª`);
  
  // ç¼“å­˜è¿‡æœŸæ—¶é—´
  let Pushtd = "";
  if (isLoon) {
    const intimed = $.read("#èŠ‚ç‚¹ç¼“å­˜æœ‰æ•ˆæœŸ");
    const loonkkk = {"1åˆ†é’Ÿ":6e4,"5åˆ†é’Ÿ":3e5,"10åˆ†é’Ÿ":6e5,"30åˆ†é’Ÿ":18e5,"1å°æ—¶":36e5,"2å°æ—¶":72e5,"3å°æ—¶":108e5,"6å°æ—¶":216e5,"12å°æ—¶":432e5,"24å°æ—¶":864e5,"48å°æ—¶":1728e5,"72å°æ—¶":2592e5,"å‚æ•°ä¼ å…¥":"innums"};
    const loontd = loonkkk[intimed] || 1728e5;
    const readt = scriptResourceCache.gettime(e[0]?.keyrk || getid(e[0]));
    const nt = new Date().getTime();
    Pushtd = `, ${zhTime(parseInt(readt, 10) - nt + parseInt(loontd, 10))}åè¿‡æœŸ \n`;
    klog("ç¼“å­˜è¿‡æœŸæ—¶é—´: " + intimed + ", è¿˜å‰©" + Pushtd.replace(/,|\n/g, ""));
  } else {
    const readt = scriptResourceCache.gettime(e[0]?.keyrk || getid(e[0]));
    const nt = new Date().getTime();
    Pushtd = `, ${zhTime(parseInt(readt, 10) - nt + parseInt(TIMEDKEY, 10))}åè¿‡æœŸ \n`;
    klog("ç¼“å­˜è¿‡æœŸæ—¶é—´: " + zhTime(TIMEDKEY) + ", è¿˜å‰©" + Pushtd.replace(/,|\n/g, ""));
  }
  
  klog(`æ­¤æ–¹æ³•æ€»ç”¨æ—¶: ${zhTime(timeDiff)}\n----For New CNAME----\n\n\n\n`);
  
  // æ˜¾ç¤ºé€šçŸ¥
  const readklog = apiStats.read ? `è¯»å–ç¼“å­˜:${apiStats.read} ` : "";
  const writeklog = apiStats.write ? `å†™å…¥ç¼“å­˜:${apiStats.write}, ` : "";
  const Push = (eout === ein && eout === 0) ? "" : (eout === ein ? "å…¨éƒ¨é€šè¿‡æµ‹è¯•, " : "å»é™¤æ— æ•ˆèŠ‚ç‚¹åæœ‰" + eout + "ä¸ª, ");
  
  if (!offtz) {
    $.notify(
      `${subcoll}${tzname} å…±${ein}ä¸ªèŠ‚ç‚¹`,
      "",
      `${writeklog}${readklog}${Pushtd}${Push}ç”¨æ—¶:${zhTime(timeDiff)}`
    );
  }
  
  return e;
}

/**
 * æ‰¹é‡å¤„ç†èŠ‚ç‚¹
 */
async function processNodesBatch(nodes, batchSize, klog, subcoll, tzname) {
  const results = [];
  const nodeCount = nodes.length;
  
  for (let i = 0; i < nodeCount; i += batchSize) {
    const batch = nodes.slice(i, i + batchSize);
    
    // ä½¿ç”¨Promise.allæ›¿ä»£Promise.allSettledï¼Œç¡®ä¿ä¸¥æ ¼è¿‡æ»¤æ— æ•ˆèŠ‚ç‚¹
    try {
      const batchResults = await Promise.all(
        batch.map(async (pk) => {
          return await processSingleNode(pk);
        })
      );
      
      // æ”¶é›†æˆåŠŸç»“æœ
      batchResults.forEach(result => {
        if (result) {
          results.push(result);
        }
      });
    } catch (err) {
      debug && klog(`æ‰¹å¤„ç†å¤±è´¥: ${err.message}`);
      // ç»§ç»­å¤„ç†ä¸‹ä¸€æ‰¹ï¼Œä¸ä¸­æ–­æ•´ä¸ªæµç¨‹
    }
    
    // æ˜¾ç¤ºè¿›åº¦
    const processed = Math.min(i + batchSize, nodeCount);
    klog(`å¤„ç†è¿›åº¦${processed}/${nodeCount}`);
    
    // è¿›åº¦é€šçŸ¥
    if (!onen && !offtz && (nodeCount > processed * 2)) {
      if (processed >= (nodeCount / 3) && processed < (nodeCount * 2 / 3)) {
        $.notify(subcoll + tzname, `å¤„ç†è¿›åº¦${processed}/${nodeCount}`, "è€å¿ƒç­‰å¾…, è¯·å‹¿é‡å¤ç‚¹å‡»é¢„è§ˆ...");
      }
    }
    
    // éç¼“å­˜æ¨¡å¼ä¸‹æ·»åŠ éšæœºå»¶è¿Ÿ
    if (!onen) {
      await sleep(GRa());
    }
  }
  
  // æ›´æ–°åŸå§‹èŠ‚ç‚¹æ•°ç»„
  nodes.splice(0, nodes.length, ...results);
  return nodes;
}

/**
 * å¤„ç†å•ä¸ªèŠ‚ç‚¹
 */
async function processSingleNode(pk) {
  let Yserver = pk.server, luodi = "", inQcip = "", nxx = "", adflag = "", OGame = "", Oisp = "", Oispflag = "", Osh = "", Oct = "", zhi = "", yuanisp = "", isCN = false, v4 = false, v6 = false, isNoAli = false;
  
  // åŸŸåè§£æ
  let inServer = await AliD(Yserver);
  debug && delog(inServer);
  
  if (inServer === "keyn") {
    isNoAli = true;
    inServer = Yserver;
  } else {
    pk.keyrk = inServer;
    if (/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(inServer)) {
      v4 = true;
    } else if (/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(inServer)) {
      v6 = true;
    }
  }
  
  // è½åœ°æŸ¥è¯¢
  let btip = true, outu = "", outips = "";
  if (!xy || yisp || yw || flag) {
    const outip = await OUTIA(pk);
    let { country: outUsq, countryCode: outUs, city: outCity, query: outQuery, isp: outisp } = outip;
    
    if (yisp) {
      yuanisp = FGFS + outisp;
    }
    
    debug && (pk.keyoutld = outip);
    debug && delog("è½åœ°ä¿¡æ¯ " + JSON.stringify(outip));
    
    outu = outUs;
    outips = outQuery;
    luodi = (outUsq === "ä¸­å›½") ? outCity : (yw ? outUs : outUsq);
    btip = outQuery !== inServer;
    pk._outips = outQuery;
  }
  
  // å…¥å£æŸ¥è¯¢
  if (btip || xy) {
    if (!isNoAli || v4) {
      const spkey = await SPEC(inServer);
      let { country: inSpCn, regionName: inSpSheng, city: inSpCity, isp: inSpIsp, ip: inSpIp, countryCode: inCode } = spkey;
      
      inflag && (pk._iflag = getflag(inCode));
      debug && (pk.keyinsp = spkey);
      
      isCN = inSpCn === "ä¸­å›½";
      inQcip = inServer;
      
      const keycm = {ç”µä¿¡:"ğŸ…³", è”é€š:"ğŸ…»", ç§»åŠ¨: "ğŸ†ˆ",å¹¿ç”µ:"ğŸ…¶"};
      if (isCN) {
        debug && delog("å›½å†…å…¥å£ " + JSON.stringify(spkey));
        
        if (iisp && flag) {
          inSpIsp = inSpIsp.replace(/ä¸­å›½/g, "");
          flag && (Oispflag = keycm.hasOwnProperty(inSpIsp) ? keycm[inSpIsp] : "ğŸ…²");
        } else if (iisp) {
          Oisp = /ç”µä¿¡|è”é€š|ç§»åŠ¨|å¹¿ç”µ/.test(inSpIsp) ? inSpIsp.replace(/ä¸­å›½/g, "") : "ä¼ä¸š";
        }
        
        (inSpSheng === inSpCity) && (inSpCity = "");
        
        if (sheng && city) {
          Osh = inSpSheng; Oct = inSpCity;
        } else if (sheng) {
          Osh = inSpSheng;
        } else if (city) {
          Oct = inSpCity ? inSpCity : inSpSheng;
        }
      }
    }
    
    if (isNoAli || v6 || !isCN) {
      const inip = await INIA(Yserver);
      let { country: inUsq, city: inCity, query: inQuery, regionName: inIpSh, countryCode: inaCode } = inip;
      
      inflag && (pk._iflag = getflag(inaCode));
      debug && (pk.keyinipapi = inip);
      debug && delog("ipapiå…¥å£ " + JSON.stringify(inip));
      
      inQcip = inQuery;
      
      if (inUsq === "ä¸­å›½") {
        (/[a-zA-Z]/.test(inCity)) && (inCity = inIpSh);
        (inCity === inIpSh) && (inIpSh = "");
        
        if (sheng && city) {
          Osh = inIpSh; Oct = inCity;
        } else if (sheng) {
          Osh = inIpSh;
        } else if (city) {
          Oct = inCity ? inCity : inIpSh;
        }
        
        flag && (Oispflag = "ğŸ…²");
      } else {
        if (inQuery === outips) {
          flag && (Oispflag = "ğŸ†‰");
          (sheng || city || iisp) && (zhi = "ç›´è¿");
        } else if (yuan) {
          flag && (Oispflag = "ğŸ…²");
          (sheng || city || iisp) && (zhi = inUsq);
        } else {
          flag && (Oispflag = "ğŸ†‡");
          (sheng || city || iisp) && (zhi = "å¢ƒå¤–");
        }
      }
    }
  } else {
    flag && (Oispflag = "ğŸ†‰");
    (sheng || city || iisp) && (zhi = "ç›´è¿");
  }
  
  // å¤„ç†å›½æ——
  flag && (adflag = getflag(outu));
  
  // å¤„ç†æ¸¸æˆæ ‡è¯†
  game && (OGame = /game|æ¸¸æˆ/i.test(pk.name) ? (flag ? "ğŸ®" : FGF + "Game") : OGame);
  
  // å¤„ç†å€ç‡
  if (bl) {
    const match = pk.name.match(/((å€ç‡|X|x|Ã—)\D?((\d\.)?\d+)\D?)|((\d\.)?\d+)(å€|X|x|Ã—)/);
    if (match) {
      const matchVa = match[0].match(/(\d[\d.]*)\D*/)[0].trim();
      if (matchVa !== "1") {
        nxx = XHFGF + matchVa + "X";
      }
    }
  }
  
  // ç”ŸæˆèŠ‚ç‚¹åç§°
  const FGF = iar.fgf == undefined ? " " : decodeURI(iar.fgf);
  const FGFS = FGF;
  const XHFGF = iar.sn == undefined ? " " : decodeURI(iar.sn);
  
  (!iisp && !city && !sheng && !xy && !inflag) && (Oispflag = "", FGF = "");
  
  let keyover = [
    firstN, 
    pk._iflag || "", 
    Oispflag, 
    Osh, 
    Oct, 
    Oisp, 
    zhi, 
    FGF, 
    adflag, 
    luodi, 
    OGame, 
    nxx, 
    yuanisp
  ].filter(ki => ki !== "");
  
  let overName = keyover.join("");
  xy && (overName = (pk._iflag || "") + overName + FGF + pk.name);
  
  // åº”ç”¨DNSè§£æ
  dns && (pk.server = inQcip);
  
  // è®¾ç½®èŠ‚ç‚¹åç§°
  pk.name = overName;
  inflag && !pk._iflag && (pk.name = getflag(outu) + overName);
  
  // è®¾ç½®å»é‡æ ‡è¯†
  pk.qc = inQcip + outips;
  
  return pk;
}

// å·¥å…·å‡½æ•°
function getid(e) { return MD5(`${e.server}-${e.port}-${e.type}`); }
function getaliid(e) { return MD5(`${CONFIG.CACHE_KEY_PREFIX.ALI}-${e}`); }
function getspcn(e) { return MD5(`${CONFIG.CACHE_KEY_PREFIX.SP}-${e}`); }
function getinid(e) { return MD5(`${CONFIG.CACHE_KEY_PREFIX.IN}-${e}`); }
function getoutid(e) { return getid(e); }

function delog(...arg) { if (debug) { console.log('[CNAME] :' + arg); } }
function sleep(e) { return new Promise((t) => setTimeout(t, e)); }
function GRa() { return Math.floor(Math.random() * (500 - 50 + 1) + 50); }

// å›½æ——ç”Ÿæˆå‡½æ•°
function getflag(e) {
  const t = e.toUpperCase().split("").map((e) => 127397 + e.charCodeAt());
  return String.fromCodePoint(...t).replace(/ğŸ‡¹ğŸ‡¼/g, "ğŸ‡¨ğŸ‡³");
}

// æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
function zhTime(e) {
  e = e.toString().replace(/-/g, "");
  if (e < 1e3) {
    return `${Math.round(e)}æ¯«ç§’`;
  } else if (e < 6e4) {
    return `${Math.round(e / 1e3)}ç§’`;
  } else if (e < 36e5) {
    return `${Math.round(e / 6e4)}åˆ†é’Ÿ`;
  } else {
    return `${Math.round(e / 36e5)}å°æ—¶`;
  }
}

// HTTPè¯·æ±‚å°è£…
async function httpGetWithTimeout(url, options = {}, timeoutMs) {
  return Promise.race([
    $.http.get({ url, ...options }),
    new Promise((_, reject) => setTimeout(() => reject(new Error(`timeout-${url}`)), timeoutMs))
  ]);
}

// APIè¯·æ±‚é€šç”¨å‡½æ•°
async function apiRequest(cacheMap, cacheKey, url, maxRetries, timeoutMs, processor) {
  // æ£€æŸ¥å†…å­˜ç¼“å­˜
  if (cacheMap.has(cacheKey)) {
    return cacheMap.get(cacheKey);
  }
  
  // æ£€æŸ¥æŒä¹…åŒ–ç¼“å­˜
  const cached = scriptResourceCache.get(cacheKey);
  if (cached) {
    apiStats.read++;
    cacheMap.set(cacheKey, cached);
    return cached;
  }
  
  inapi++;
  
  // å‘é€è¯·æ±‚
  let retryCount = 0;
  while (retryCount < maxRetries) {
    try {
      const response = await httpGetWithTimeout(url, {}, timeoutMs);
      
      // ä¸¥æ ¼æ£€æŸ¥å“åº”
      if (!response || !response.body) {
        throw new Error(`æ— æ•ˆå“åº”: ${url}`);
      }
      
      const data = JSON.parse(response.body);
      
      // æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
      if (!data || typeof data !== 'object') {
        throw new Error(`æ— æ•ˆæ•°æ®æ ¼å¼: ${url}`);
      }
      
      // è°ƒç”¨å¤„ç†å™¨å¤„ç†æ•°æ®
      const result = processor(data);
      
      // æ£€æŸ¥å¤„ç†ç»“æœæœ‰æ•ˆæ€§
      if (!result || typeof result !== 'object') {
        throw new Error(`æ— æ•ˆå¤„ç†ç»“æœ: ${url}`);
      }
      
      // ç¼“å­˜ç»“æœ
      scriptResourceCache.set(cacheKey, result);
      cacheMap.set(cacheKey, result);
      apiStats.write++;
      
      return result;
    } catch (error) {
      retryCount++;
      if (retryCount < maxRetries) {
        await sleep(GRa());
        delog(`${url} -> [è¶…æ—¶æŸ¥è¯¢æ¬¡æ•°] ${retryCount}`);
      } else {
        throw error;
      }
    }
  }
}

// è½åœ°IPæŸ¥è¯¢
async function OUTIA(e) {
  const t = getoutid(e);
  const url = `http://ip-api.com/json?lang=zh-CN&fields=status,message,country,countryCode,city,query,isp`;
  
  return apiRequest(CACHE_MAPS.oaMap, t, url, CONFIG.RETRY_MAX, timeout, (data) => {
    if (data.status === "success") {
      return data;
    } else {
      throw new Error(data.message);
    }
  });
}

// åŸŸåè§£æ
async function AliD(e) {
  const ti = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$|^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e);
  if (ti) return e;
  
  const t = getaliid(e);
  const alip = Math.random() < 0.5 ? '223.5.5.5' : '223.6.6.6';
  const url = `https://${alip}/resolve?name=${e}&type=A&short=1`;
  
  return apiRequest(CACHE_MAPS.alMap, t, url, CONFIG.RETRY_MAX, timeout, (resdata) => {
    if (resdata.length > 0) {
      return resdata[0];
    } else {
      return "keyn";
    }
  });
}

// å›½å†…å…¥å£IPæŸ¥è¯¢
async function SPEC(e) {
  const n = getspcn(e);
  const url = `https://api-v${keyp}${keypr}.cn/ip?ip=${e}`;
  
  return apiRequest(CACHE_MAPS.spMap, n, url, CONFIG.RETRY_MAX, timeout, (resdata) => {
    if (resdata.data) {
      const { country: e, province: o, city: r, isp: i, ip: c, countryCode: k } = resdata.data;
      return { country: e, regionName: o, city: r, isp: i, ip: c, countryCode: k };
    } else {
      throw new Error(resdata.message);
    }
  });
}

// å›½å¤–å…¥å£IPæŸ¥è¯¢
async function INIA(e) {
  const t = getinid(e);
  const url = `http://ip-api.com/json/${e}?lang=zh-CN&fields=status,message,country,city,query,regionName,countryCode`;
  
  return apiRequest(CACHE_MAPS.iaMap, t, url, CONFIG.RETRY_MAX, timeout, (data) => {
    if (data.status === "success") {
      return data;
    } else {
      throw new Error(data.message);
    }
  });
}

// èŠ‚ç‚¹å»é‡å‡½æ•° - ä¸¥æ ¼æ¨¡å¼
function removels(e) {
  const t = new Set();
  const n = [];
  
  for (const s of e) {
    // ä¸¥æ ¼æ£€æŸ¥qcå±æ€§ï¼Œç¡®ä¿æœ‰æ•ˆ
    if (s.qc && typeof s.qc === 'string' && s.qc.length > 0) {
      // ä½¿ç”¨æ›´ä¸¥æ ¼çš„å»é‡é€»è¾‘ï¼Œç¡®ä¿æ¯ä¸ªqcåªå¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹
      if (!t.has(s.qc)) {
        t.add(s.qc);
        n.push(s);
      }
    }
    // æ²¡æœ‰qcå±æ€§çš„èŠ‚ç‚¹è§†ä¸ºæ— æ•ˆèŠ‚ç‚¹ï¼Œç›´æ¥è¿‡æ»¤
  }
  
  return n;
}

function removeqc(e) {
  const t = new Set();
  const n = [];
  for (const s of e) {
    if (!t.has(s.qc)) {
      t.add(s.qc);
      const cleaned = { ...s };
      delete cleaned.qc;
      delete cleaned._iflag;
      delete cleaned._outips;
      n.push(cleaned);
    }
  }
  return n;
}

// èŠ‚ç‚¹é‡æ–°ç¼–å·
function jxh(e) {
  const t = e.reduce((acc, curr) => {
    const key = curr.name.replace(/\s*\d+$/, "");
    if (!acc[key]) {
      acc[key] = [];
    }
    acc[key].push(curr);
    return acc;
  }, {});
  
  const result = [];
  for (const key in t) {
    const nodes = t[key];
    nodes.forEach((node, index) => {
      const newName = `${key}${XHFGF}${(index + 1).toString().padStart(2, "0")}`;
      result.push({ ...node, name: newName });
    });
  }
  
  return result;
}

// æ¸…ç†å•èŠ‚ç‚¹åºå·
function onee(e) {
  const t = e.reduce((acc, curr) => {
    const key = curr.name.replace(/[^A-Za-z0-9\u00C0-\u017F\u4E00-\u9FFF]+\d+$/, "");
    if (!acc[key]) {
      acc[key] = [];
    }
    acc[key].push(curr);
    return acc;
  }, {});
  
  for (const key in t) {
    if (t[key].length === 1 && t[key][0].name.endsWith("01")) {
      t[key][0].name = t[key][0].name.replace(/[^.]01$/, "");
    }
  }
  
  return Object.values(t).flat();
}

// MD5å‡½æ•°
var MD5=function(e){var t=M(V(Y(X(e),8*e.length)));return t.toLowerCase()};function M(e){for(var t,n="0123456789ABCDEF",s="",o=0;o<e.length;o++)t=e.charCodeAt(o),s+=n.charAt(t>>>4&15)+n.charAt(15&t);return s}function X(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function V(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function Y(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,s=-271733879,o=-1732584194,r=271733878,i=0;i<e.length;i+=16){var c=n,a=s,u=o,m=r;s=md5_ii(s=md5_ii(s=md5_ii(s=md5_ii(s=md5_hh(s=md5_hh(s=md5_hh(s=md5_hh(s=md5_gg(s=md5_gg(s=md5_gg(s=md5_gg(s=md5_ff(s=md5_ff(s=md5_ff(s=md5_ff(s,o=md5_ff(o,r=md5_ff(r,n=md5_ff(n,s,o,r,e[i+0],7,-680876936),s,o,e[i+1],12,-389564586),n,s,e[i+2],17,606105819),r,n,e[i+3],22,-1044525330),o=md5_ff(o,r=md5_ff(r,n=md5_ff(n,s,o,r,e[i+4],7,-176418897),s,o,e[i+5],12,1200080426),n,s,e[i+6],17,-1473231341),r,n,e[i+7],22,-45705983),o=md5_ff(o,r=md5_ff(r,n=md5_ff(n,s,o,r,e[i+8],7,1770035416),s,o,e[i+9],12,-1958414417),n,s,e[i+10],17,-42063),r,n,e[i+11],22,-1990404162),o=md5_ff(o,r=md5_ff(r,n=md5_ff(n,s,o,r,e[i+12],7,1804603682),s,o,e[i+13],12,-40341101),n,s,e[i+14],17,-1502002290),r,n,e[i+15],22,1236535329),o=md5_gg(o,r=md5_gg(r,n=md5_gg(n,s,o,r,e[i+1],5,-165796510),s,o,e[i+6],9,-1069501632),n,s,e[i+11],14,643717713),r,n,e[i+0],20,-373897302),o=md5_gg(o,r=md5_gg(r,n=md5_gg(n,s,o,r,e[i+5],5,-701558691),s,o,e[i+10],9,38016083),n,s,e[i+15],14,-660478335),r,n,e[i+4],20,-405537848),o=md5_gg(o,r=md5_gg(r,n=md5_gg(n,s,o,r,e[i+9],5,568446438),s,o,e[i+14],9,-1019803690),n,s,e[i+3],14,-187363961),r,n,e[i+8],20,1163531501),o=md5_gg(o,r=md5_gg(r,n=md5_gg(n,s,o,r,e[i+13],5,-1444681467),s,o,e[i+2],9,-51403784),n,s,e[i+7],14,1735328473),r,n,e[i+12],20,-1926607734),o=md5_hh(o,r=md5_hh(r,n=md5_hh(n,s,o,r,e[i+5],4,-378558),s,o,e[i+8],11,-2022574463),n,s,e[i+11],16,1839030562),r,n,e[i+14],23,-353095),o=md5_hh(o,r=md5_hh(r,n=md5_hh(n,s,o,r,e[i+4],4,-722521979),s,o,e[i+7],11,76029189),n,s,e[i+10],16,-640364487),r,n,e[i+13],23,-421815835),o=md5_hh(o,r=md5_hh(r,n=md5_hh(n,s,o,r,e[i+2],4,530742520),s,o,e[i+5],11,-995338651),n,s,e[i+8],16,604817799),r,n,e[i+11],23,-198630844),o=md5_hh(o,r=md5_hh(r,n=md5_hh(n,s,o,r,e[i+0],4,-57434055),s,o,e[i+3],11,1873313359),n,s,e[i+6],16,-30611744),r,n,e[i+9],23,-1560198380),o=md5_ii(o,r=md5_ii(r,n=md5_ii(n,s,o,r,e[i+15],6,1309151649),s,o,e[i+14],10,-145523070),n,s,e[i+13],15,-716787086),r,n,e[i+12],21,380534534),o=md5_ii(o,r=md5_ii(r,n=md5_ii(n,s,o,r,e[i+11],6,-1364034841),s,o,e[i+10],10,-1069501632),n,s,e[i+9],15,606105819),r,n,e[i+8],21,-1735328473),o=md5_ii(o,r=md5_ii(r,n=md5_ii(n,s,o,r,e[i+7],6,1236535329),s,o,e[i+6],10,-1272893353),n,s,e[i+5],15,-165796510),r,n,e[i+4],21,-1001043312),o=md5_ii(o,r=md5_ii(r,n=md5_ii(n,s,o,r,e[i+3],6,1979021679),s,o,e[i+2],10,-1894986606),n,s,e[i+1],15,1163531501),r,n,e[i+0],21,-306404559),n^=c,s^=a,o^=u,r^=m};return r}function md5_cmn(e,t,n,s,o,r){return md5_rol((t&n)|(~t&s)+e+o,r)}function md5_ff(e,t,n,s,o,r,i){return md5_cmn(t&n|~t&s,e,t,o,r,i)}function md5_gg(e,t,n,s,o,r,i){return md5_cmn(t&s|n&~s,e,t,o,r,i)}function md5_hh(e,t,n,s,o,r,i){return md5_cmn(t^n^s,e,t,o,r,i)}function md5_ii(e,t,n,s,o,r,i){return md5_cmn(n^(t|~s),e,t,o,r,i)}function md5_rol(e,t){return e<<t|e>>>32-t}
