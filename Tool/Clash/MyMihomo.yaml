# mihomo 配置
# 配置作者：Colin(@ColinYYCC)
# 适用版本：所有使用 mihomo 核心的程序
# 以 ';' 或 '#' 或 '//' 开头的配置文件行为注释行

### 节点配置
NodeParam: &NodeParam {type: http, interval: 86400, proxy: DIRECT, health-check: {enable: true, url: http://networkcheck.kde.org, interval: 1800}, filter: '^(?!.*(?:(?:群|邀请|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持)|(?i:\b(?:USE|USED|COM|TOTAL|EXPIRE|EMAIL|Panel)\b)|[\p{Han}]\.com)).*$'}
# 节点订阅
proxy-providers:
  MyMihomo: {<<: *NodeParam, url: '替换订阅链接'}
  MyBackup: {<<: *NodeParam, url: '替换订阅链接'}
  
### 核心配置
mode: rule
mixed-port: 7893
allow-lan: true
ipv6: true
unified-delay: true
tcp-concurrent: true
log-level: warning
bind-address: '*'
find-process-mode: 'always'
global-client-fingerprint: chrome
keep-alive-interval: 15
keep-alive-idle: 600

# 实验性功能
experimental:
  quic-go-disable-gso: true 

# 认证配置
authentication:
  - mihomo:Mh2026@SecurePass!
skip-auth-prefixes:
  - 192.168.1.0/24
  - 192.168.31.0/24
  - 192.168.100.0/24
  - 127.0.0.1/8

### 如果使用的是裸核, 需要将下面的注释去掉, 方便ui界面的使用
# 管理面板配置
external-ui-url: 'https://mirror.ghproxy.com/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip'
external-ui: ui
external-controller: 127.0.0.1:9988
secret: Mh2026@SecurePass!

# 配置存储
profile:
  store-selected: true
  store-fake-ip: true

geodata-mode: true
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: 'https://mirror.ghproxy.com/https://github.com/xream/geoip/releases/latest/download/ipinfo.geoip.dat'
  mmdb: 'https://mirror.ghproxy.com/https://github.com/xream/geoip/releases/latest/download/ipinfo.country.mmdb'
  asn: 'https://mirror.ghproxy.com/https://github.com/xream/geoip/releases/latest/download/ipinfo.asn.mmdb'

### DNS配置
dns:
  enable: true
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://dns.pub/dns-query
    - https://dns.alidns.com/dns-query
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.internal'
    - 'localhost.ptlogin2.qq.com'
    - '+.srv.nintendo.net'
    - '+.stun.playstation.net'
    - 'xbox.*.microsoft.com'
    - '+.xboxlive.com'
    - 'stun.*'
    - '+.push.apple.com'

### 域名嗅探
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - Mijia Cloud
    - +.push.apple.com
    - +.mzstatic.com
    - +.icloud.com
    - +.icloud-content.com
    - gamecenter.apple.com

### TUN配置
tun:
  enable: true
  stack: system
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  strict-route: true
# 如果有使用zerotier或者headscale等, 需要自己配置排除自己的网段
# route-exclude-address: ['192.168.110.0/24']

#### 节点组参数锚点
# 锚点 - 时延优选参数 [每 600 秒一次惰性健康检查, 容差 100ms, 时延超过 3 秒判定为失败, 失败 3 次则自动触发健康检查]
UrlTest: &UrlTest {type: url-test, url: http://networkcheck.kde.org, interval: 1800, lazy: true, tolerance: 100, timeout: 3000, disable-udp: false, max-failed-times: 3, hidden: true}
# 锚点 - 故障转移参数 [每 600 秒一次惰性健康检查, 时延超过 3 秒判定为失败, 失败 3 次则自动触发健康检查]
FallBack: &FallBack {type: fallback, url: http://networkcheck.kde.org, interval: 1800, lazy: true, tolerance: 100, timeout: 3000, disable-udp: false, max-failed-times: 3, hidden: true}
# 锚点 - 负载均衡参数 [每 600 秒一次惰性健康检查, 时延超过 3 秒判定为失败, 失败 3 次则自动触发健康检查]
LoadBalance: &LoadBalance {type: load-balance, url: http://networkcheck.kde.org, interval: 1800, lazy: true, disable-udp: false, strategy: consistent-hashing, timeout: 3000, max-failed-times: 3, hidden: true}

# 节点筛选正则表达式 - 基于地理位置和关键词过滤
FilterHK: &FilterHK '^(?=.*(香港|HK|Hong|🇭🇰))(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$'
FilterJP: &FilterJP '^(?=.*(日本|JP|Japan|🇯🇵))(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$'
FilterKR: &FilterKR '^(?=.*(韩国|韓|KR|Korea|🇰🇷))(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$'
FilterSG: &FilterSG '^(?=.*(新加坡|狮城|SG|Singapore|🇸🇬))(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$'
FilterUS: &FilterUS '^(?=.*(美国|US|United States|America|🇺🇸))(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$'
FilterTW: &FilterTW '^(?=.*(台湾|TW|Taiwan|Wan|🇹🇼|🇨🇳))(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$'
FilterOthers: &FilterOT '^(?!.*(🇭🇰|HK|Hong|香港|🇹🇼|TW|Taiwan|Wan|🇯🇵|JP|Japan|日本|🇸🇬|SG|Singapore|狮城|🇺🇸|US|United States|America|美国|🇩🇪|DE|Germany|德国|🇬🇧|UK|United Kingdom|英国|🇰🇷|KR|Korea|韩国|韓|🇫🇷|FR|France|法国)).*$'
FilterAll: &FilterAL '^(?!.*(?:(?:群|邀请|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持)|(?i:\b(?:USE|USED|TOTAL|EXPIRE|EMAIL|Panel)\b)|[\p{Han}]\.com)).*$'

# 策略组代理列表模板 - 预定义的代理节点优先级排序
SelectBL: &SelectBL {type: select, proxies: [🔮 负载均衡, 🛰️ 自动选择, 🔯 故障转移, 香港节点, 台湾节点, 日本节点, 韩国节点, 狮城节点, 美国节点, DIRECT]}
SelectFB: &SelectFB {type: select, proxies: [🔯 故障转移, 🛰️ 自动选择, 🔮 负载均衡, 香港节点, 台湾节点, 日本节点, 韩国节点, 狮城节点, 美国节点, DIRECT]}
SelectUT: &SelectUT {type: select, proxies: [🛰️ 自动选择, 🔮 负载均衡, 🔯 故障转移, 香港节点, 台湾节点, 日本节点, 韩国节点, 狮城节点, 美国节点, DIRECT]}
SelectDT: &SelectDT {type: select, proxies: [DIRECT, 🛰️ 自动选择, 🔮 负载均衡, 🔯 故障转移, 香港节点, 台湾节点, 日本节点, 韩国节点, 狮城节点, 美国节点]}
# ------

# 节点组
proxy-groups:
# 主要节点
  - {name: 🛰️ 自动选择, <<: *UrlTest, include-all: true, filter: *FilterAL, icon: https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/quanqiu(3).png}
  - {name: 🔯 故障转移, <<: *FallBack, include-all: true, filter: *FilterAL, icon: https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/select.png}
  - {name: 🔮 负载均衡, <<: *LoadBalance, include-all: true, filter: *FilterAL, icon: https://github.com/shindgewongxj/WHATSINStash/raw/main/icon/loadbalance.png}
  - {name: 手动切换, <<: *SelectBL, icon: https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/Loon_27.png}
  - {name: 漏网之鱼, <<: *SelectFB, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/Snapfish.png}
# 分流策略组
  - {name: 国外网站, <<: *SelectBL, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/Twitter.png}
  - {name: Telegram, <<: *SelectBL, icon: https://raw.githubusercontent.com/ColinYYCC/Network-Tool/refs/heads/main/Resource/Logo/SVG/telegram.svg}
  - {name: Apple Service, <<: *SelectDT, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/Apple.png}
  - {name: AI, <<: *SelectUT, icon: https://raw.githubusercontent.com/ColinYYCC/Network-Tool/refs/heads/main/Resource/Logo/SVG/qwen-color.svg}
# 媒体策略组
  - {name: Netflix, type: select, proxies: [狮城节点, 香港节点, 日本节点, 美国节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://github.com/ColinYYCC/Network-Tool/raw/main/Resource/Logo/SVG/netflix.svg}
  - {name: Youtube, type: select, proxies: [美国节点, 香港节点, 狮城节点, 日本节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/YouTube.png}
  - {name: Spotify, type: select, proxies: [香港节点, 美国节点, 狮城节点, 日本节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://github.com/ColinYYCC/Network-Tool/raw/main/Resource/Logo/SVG/spotify.svg}
  - {name: Disney+, type: select, proxies: [狮城节点, 香港节点, 台湾节点, 日本节点, 美国节点, 韩国节点], icon: https://github.com/ColinYYCC/Network-Tool/raw/main/Resource/Logo/SVG/disney-plus.svg}
  - {name: 国际媒体, type: select, proxies: [狮城节点, 香港节点, 日本节点, 美国节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://github.com/ColinYYCC/Network-Tool/raw/main/Resource/Logo/SVG/disney-plus.svg}
  - {name: Emby, type: select, proxies: [香港节点, 美国节点, 狮城节点, 日本节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://raw.githubusercontent.com/ColinYYCC/Network-Tool/refs/heads/main/Resource/Logo/SVG/emby.svg}
# 游戏
  - {name: 游戏, type: select, proxies: [DIRECT, 🛰️ 自动选择, 🔯 故障转移], icon: https://github.com/ColinYYCC/Network-Tool/raw/main/Resource/Logo/SVG/steam.svg}
# 自动选择
  - {name: 香港节点, <<: *LoadBalance, include-all: true, filter: *FilterHK, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Hong_Kong.png, hidden: true}
  - {name: 日本节点, <<: *LoadBalance, include-all: true, filter: *FilterJP, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Japan.png, hidden: true}
  - {name: 韩国节点, <<: *LoadBalance, include-all: true, filter: *FilterKR, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/South_Korea.png, hidden: true}
  - {name: 狮城节点, <<: *LoadBalance, include-all: true, filter: *FilterSG, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Singapore.png, hidden: true}
  - {name: 美国节点, <<: *LoadBalance, include-all: true, filter: *FilterUS, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/United_States.png, hidden: true}
  - {name: 台湾节点, <<: *LoadBalance, include-all: true, filter: *FilterTW, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Taiwan.png, hidden: true}
# ------

# 分流规则
rules:
# 自定义规则
## 您可以在此处插入自定义规则
  - DOMAIN-SUFFIX,zoom.us,国外网站
  - DOMAIN-KEYWORD,todesk,DIRECT
  - DOMAIN-KEYWORD,AnyViewer,DIRECT

### 拦截规则
  - RULE-SET,sogouinput,REJECT
  - RULE-SET,AWAvenue-Ads-Rule,REJECT
  - RULE-SET,Adobe跟踪&SDK打点,REJECT-DROP
  - RULE-SET,视频QUIC&PCDN,REJECT

### 非 IP 类规则
  - RULE-SET,苹果服务,Apple Service
  - RULE-SET,常见静态CDN域名集,手动切换
  - RULE-SET,常见静态CDN,手动切换
  - RULE-SET,苹果CDN域名集,DIRECT
  - RULE-SET,苹果中国,DIRECT
  - RULE-SET,微软CDN,DIRECT
  - RULE-SET,微软服务,DIRECT
  - RULE-SET,Netflix,Netflix
  - RULE-SET,Youtube,Youtube
  - RULE-SET,Spotify,Spotify
  - RULE-SET,Emby,Emby
  - RULE-SET,Disney,Disney+
  - RULE-SET,美国流媒体,美国节点
  - RULE-SET,欧洲流媒体,国外网站
  - RULE-SET,日本流媒体,日本节点
  - RULE-SET,韩国流媒体,韩国节点
  - RULE-SET,香港流媒体,香港节点
  - RULE-SET,台湾流媒体,台湾节点
  - RULE-SET,国际流媒体,国外网站
  - RULE-SET,Telegram,Telegram
  - RULE-SET,下载域名集,手动切换
  - RULE-SET,下载,手动切换
  - RULE-SET,人工智能,AI
  - RULE-SET,全球,国外网站
  - RULE-SET,LAN,DIRECT
  - RULE-SET,国内域名,DIRECT
  - RULE-SET,直连,DIRECT

### IP 类规则
  - RULE-SET,ASN China,DIRECT
  - RULE-SET,国际流媒体IP,国外网站
  - RULE-SET,内网IP,DIRECT
  - RULE-SET,国内IP,DIRECT

### 其他 类规则
  - GEOIP,CN,DIRECT
  - MATCH,漏网之鱼

# 规则配置
ClassicalT: &ClassicalT {type: http, behavior: classical, interval: 86400, format: text}
ClassicalY: &ClassicalY {type: http, behavior: classical, interval: 86400, format: yaml}
DomainT: &DomainT {type: http, behavior: domain, interval: 86400, format: text}
DomainY: &DomainY {type: http, behavior: domain, interval: 86400, format: yaml}
DomainM: &DomainM {type: http, behavior: domain, interval: 86400, format: mrs}
DomainI: &DomainI {type: http, behavior: ipcidr, interval: 86400, format: mrs}
ipcidr: &ipcidr {type: http, behavior: ipcidr, interval: 86400, format: text}


# 订阅规则
rule-providers:
# 拦截类规则
  sogouinput: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/sogouinput.txt}
  AWAvenue-Ads-Rule: {<<: *DomainY, url: https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml}
  Adobe跟踪&SDK打点: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/reject-drop.txt}
  视频QUIC&PCDN: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/reject-no-drop.txt}

# 常见静态 CDN
  常见静态CDN域名集: {<<: *DomainT, url: https://ruleset.skk.moe/Clash/domainset/cdn.txt}
  常见静态CDN: {<<: *DomainT, url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt}

# 流媒体服务
  Emby: {<<: *ClassicalY , url: https://github.com/Repcz/Tool/raw/X/mihomo/Rules/Emby.list}
  Netflix: {<<: *ClassicalY, url: https://raw.githubusercontent.com/dler-io/Rules/main/Clash/Provider/Media/Netflix.yaml}
  Youtube: {<<: *DomainM, url: https://github.com/666OS/rules/raw/release/mihomo/domain/YouTube.mrs}
  Spotify: {<<: *DomainM, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Spotify.mrs}
  Disney: {<<: *DomainM, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Disney.mrs}
  美国流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream_us.txt}
  欧洲流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream_eu.txt}
  日本流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream_jp.txt}
  韩国流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream_kr.txt}
  香港流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream_hk.txt}
  台湾流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream_tw.txt}
  国际流媒体: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream.txt}

# 即时通讯
  Telegram: {<<: *ClassicalT, url: https://github.com/LucaLin233/Luca_Conf/raw/main/Surge/Rule/Telegram.list}

# 人工智能 
  人工智能: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/ai.txt}

# 苹果服务
  苹果CDN域名集: {<<: *DomainT, url: https://ruleset.skk.moe/Clash/domainset/apple_cdn.txt}
  苹果服务: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/apple_services.txt}
  苹果中国: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt}

# 微软服务
  微软CDN: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt}
  微软服务: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/microsoft.txt}

# 下载服务
  下载域名集: {<<: *DomainT, url: https://ruleset.skk.moe/Clash/domainset/download.txt}
  下载: {<<: *DomainT, url: https://ruleset.skk.moe/Clash/non_ip/download.txt}

# 网络区域
  LAN: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/lan.txt}
  国内域名: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/domestic.txt}
  直连: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/direct.txt}
  ASN China: {<<: *ClassicalY, url: https://raw.githubusercontent.com/VirgilClyne/GetSomeFries/main/ruleset/ASN.China.yaml}
  全球: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/non_ip/global.txt} 

# IP 类规则
  内网IP: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/ip/lan.txt}
  国内IP: {<<: *DomainI, url: https://github.com/666OS/rules/raw/release/mihomo/ip/China.mrs}
  国际流媒体IP: {<<: *ClassicalT, url: https://ruleset.skk.moe/Clash/ip/stream.txt}
