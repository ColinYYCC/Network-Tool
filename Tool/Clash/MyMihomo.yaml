# mihomo 配置
# 配置作者：Colin(@ColinYYCC) & YY(@yyhhyyyyyy)
# 适用版本：所有使用 mihomo 核心的程序
# 以 ';' 或 '#' 或 '//' 开头的配置文件行为注释行

### 节点配置
NodeParam: &NodeParam  {type: http, interval: 86400, proxy: DIRECT, health-check: {enable: true, url: 'https://wifi.vivo.com.cn/generate_204', interval: 300}, filter: "^(?=.*)(?!.*(?:(?:群|邀请|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持)|(?i:\b(?:USE|USED|TOTAL|EXPIRE|EMAIL|Panel)\b))).*$"}
# 节点订阅
proxy-providers: 
  Subscribe: {<<: *NodeParam, url: "替换订阅链接"}

### 全局配置
mode: rule
mixed-port: 7897
allow-lan: true
ipv6: true
unified-delay: true
tcp-concurrent: true
log-level: warning
bind-address: '*'
find-process-mode: 'always'
global-client-fingerprint: chrome
keep-alive-interval: 15
keep-alive-idle: 600

# 实验性功能
experimental:
  quic-go-disable-gso: true 

### 如果使用的是裸核，需要将下面的注释去掉，方便ui界面的使用
# external-controller: 0.0.0.0:9988
# external-ui: ui
# external-ui-url: "https://mirror.ghproxy.com/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip"

# 配置存储
profile:
  store-selected: true
  store-fake-ip: true

geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://github.com/xream/geoip/releases/latest/download/ipinfo.geoip.dat"
  geosite: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://github.com/xream/geoip/releases/latest/download/ipinfo.country.mmdb"
  asn: "https://github.com/xream/geoip/releases/latest/download/ipinfo.asn.mmdb"

### DNS配置
dns:
  enable: true
  prefer-h3: true
  ipv6: true
  enhanced-mode: fake-ip
  Listen: 1053
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 119.29.29.29
    - 180.184.1.1
    - 223.5.5.5
  nameserver:
    - https://dns.quad9.net/dns-query
    - https://doh.pub/dns-query
    - https://dns.alidns.com
  fake-ip-filter:
    - +.m2m
    - injections.adguard.org
    - local.adguard.org
    - +.bogon
    - +.lan
    - +.local
    - +.internal
    - +.localdomain
    - home.arpa
    - 127.0.0.1.sslip.io
    - 127.atlas.skk.moe
    - dns.msftncsi.com
    - "*.srv.nintendo.net"
    - "*.stun.playstation.net"
    - xbox.*.microsoft.com
    - "*.xboxlive.com"
    - "*.turn.twilio.com"
    - "*.stun.twilio.com"
    - stun.syncthing.net
    - stun.*
    - 127.*.*.*.sslip.io
    - 127-*-*-*.sslip.io
    - "*.127.*.*.*.sslip.io"
    - "*-127-*-*-*.sslip.io"
    - 127.*.*.*.nip.io
    - 127-*-*-*.nip.io
    - "*.127.*.*.*.nip.io"
    - "*-127-*-*-*.nip.io"

### 域名嗅探
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

### TUN配置
tun:
  enable: true
  stack: mixed
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  strict-route: true
  mtu: 1500
  route-exclude-address:
    - 100.64.0.0/10
    - 127.0.0.0/8
    - 169.254.0.0/16
    - 172.16.0.0/12
    - 192.168.0.0/16
    - 224.0.0.0/4
    - 255.255.255.255/32
  # 如果有使用zerotier或者headscale等，需要自己配置排除自己的网段
  # route-exclude-address: ["192.168.110.0/24"]

#### 节点组参数锚点
# 锚点 - 时延优选参数 [每 300 秒一次惰性健康检查，容差 20ms，时延超过 2 秒判定为失败，失败 3 次则自动触发健康检查]
UrlTest: &UrlTest {type: url-test, url: "https://wifi.vivo.com.cn/generate_204", interval: 300, lazy: true, tolerance: 50, timeout: 2000, disable-udp: false, max-failed-times: 3, hidden: true}
# 锚点 - 故障转移参数 [每 300 秒一次惰性健康检查，时延超过 2 秒判定为失败，失败 3 次则自动触发健康检查]
FallBack: &FallBack {type: fallback, url: "https://wifi.vivo.com.cn/generate_204", interval: 300, lazy: true, tolerance: 50, timeout: 2000, disable-udp: false, max-failed-times: 2, hidden: true}
# 锚点 - 负载均衡参数 [每 300 秒一次惰性健康检查，时延超过 2 秒判定为失败，失败 3 次则自动触发健康检查]
LoadBalance: &LoadBalance {type: load-balance, url: "https://wifi.vivo.com.cn/generate_204", interval: 300, lazy: true, disable-udp: false, strategy: consistent-hashing, timeout: 2000, max-failed-times: 2, hidden: true}

# 节点筛选正则表达式 - 基于地理位置和关键词过滤
FilterHK: &FilterHK "^(?=.*(香港|HK|Hong|🇭🇰))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterJP: &FilterJP "^(?=.*(日本|JP|Japan|🇯🇵))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterKR: &FilterKR "^(?=.*(韩国|韓|KR|Korea|🇰🇷))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterSG: &FilterSG "^(?=.*(新加坡|狮城|SG|Singapore|🇸🇬))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterUS: &FilterUS "^(?=.*(美国|US|United States|America|🇺🇸))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterUK: &FilterUK "^(?=.*(英国|UK|United Kingdom|🇬🇧))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterFR: &FilterFR "^(?=.*(法国|FR|France|🇫🇷))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterDE: &FilterDE "^(?=.*(德国|DE|Germany|🇩🇪))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterTW: &FilterTW "^(?=.*(台湾|TW|Taiwan|Wan|🇹🇼|🇨🇳))^(?!.*(网站|地址|剩余|过期|时间|有效|网址|禁止|邮箱|发布|客服|订阅|节点)).*$"
FilterOthers: &FilterOT "^(?!.*(🇭🇰|HK|Hong|香港|🇹🇼|TW|Taiwan|Wan|🇯🇵|JP|Japan|日本|🇸🇬|SG|Singapore|狮城|🇺🇸|US|United States|America|美国|🇩🇪|DE|Germany|德国|🇬🇧|UK|United Kingdom|英国|🇰🇷|KR|Korea|韩国|韓|🇫🇷|FR|France|法国)).*$"
FilterAll: &FilterAL "^(?=.*)(?!.*(?:(?:群|邀请|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持)|(?i:\b(?:USE|USED|TOTAL|EXPIRE|EMAIL|Panel)\b))).*$"

# 策略组代理列表模板 - 预定义的代理节点优先级排序
SelectFB: &SelectFB {type: select, proxies: [🔯 故障转移, 🛰️ 自动选择, 🔮 负载均衡, 香港节点, 台湾节点, 日本节点, 韩国节点, 狮城节点, 美国节点, DIRECT]}
SelectPY: &SelectUT {type: select, proxies: [🛰️ 自动选择, 🔮 负载均衡, 🔯 故障转移, 香港节点, 台湾节点, 日本节点, 韩国节点, 狮城节点, 美国节点, DIRECT]}
# ------

# 节点组
proxy-groups:
  # 主要节点
  - {name: 🛰️ 自动选择, <<: *UrlTest, include-all: true, filter: *FilterAL, icon: https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/quanqiu(3).png}
  - {name: 🔯 故障转移, <<: *FallBack, include-all: true, filter: *FilterAL, icon: https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/select.png}
  - {name: 🔮 负载均衡, <<: *LoadBalance, include-all: true, filter: *FilterAL, icon: https://github.com/shindgewongxj/WHATSINStash/raw/main/icon/loadbalance.png}
  - {name: 手动切换, <<: *SelectUT, icon: https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/Loon_27.png}
  - {name: 漏网之鱼, <<: *SelectFB, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/Snapfish.png}

  # 分流策略组
  - {name: 国外网站, <<: *SelectUT, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/Twitter.png}
  - {name: Telegram, <<: *SelectUT, icon: https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/telegram(blue1).png}
  - {name: Apple Service, type: select, proxies: [DIRECT, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡, 香港节点, 美国节点, 狮城节点, 日本节点, 韩国节点, 台湾节点], icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/Apple.png}
  - {name: AI, <<: *SelectUT, icon: https://github.com/ColinYYCC/Network-Tool/raw/main/Resource/Logo/DeepSeek.png}

  # > 媒体策略组
  - {name: Netflix, type: select, proxies: [狮城节点, 香港节点, 日本节点, 美国节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/lige47/netflix(red).png}
  - {name: YouTube, type: select, proxies: [香港节点, 美国节点, 狮城节点, 日本节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Social_Media/YouTube.png}
  - {name: Disney+, type: select, proxies: [狮城节点, 香港节点, 日本节点, 美国节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/lige47/disney(blue).png}
  - {name: Spotify, type: select, proxies: [香港节点, 美国节点, 狮城节点, 日本节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://github.com/tugepaopao/Image-Storage/raw/master/cartoon/Cute/spotify.png}
  - {name: Emby, type: select, proxies: [香港节点, 美国节点, 狮城节点, 日本节点, 韩国节点, 台湾节点, 🛰️ 自动选择, 🔯 故障转移, 🔮 负载均衡], icon: https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/emby.png}
  # 游戏
  - {name: 游戏, type: select, proxies: [DIRECT, 🛰️ 自动选择, 🔯 故障转移], icon: https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/steam(1).png}

  # > 白名单模式 PROXY, 黑名单模式 DIRECT
 
  # ------

  # 自动选择
  - {name: 香港节点, <<: *UrlTest, include-all: true, filter: *FilterHK, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Hong_Kong.png}
  - {name: 日本节点, <<: *UrlTest, include-all: true, filter: *FilterJP, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Japan.png}
  - {name: 韩国节点, <<: *UrlTest, include-all: true, filter: *FilterKR, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/South_Korea.png}
  - {name: 狮城节点, <<: *UrlTest, include-all: true, filter: *FilterSG, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Singapore.png}
  - {name: 美国节点, <<: *UrlTest, include-all: true, filter: *FilterUS, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/United_States.png}
  - {name: 英国节点, <<: *UrlTest, include-all: true, filter: *FilterUK, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/United_Kingdom.png}
  - {name: 法国节点, <<: *UrlTest, include-all: true, filter: *FilterFR, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/France.png}
  - {name: 德国节点, <<: *UrlTest, include-all: true, filter: *FilterDE, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Germany.png}
  - {name: 台湾节点, <<: *UrlTest, include-all: true, filter: *FilterTW, icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/master/Rounded_Rectangle/Taiwan.png}

### 规则配置
RuleSet_classicalT: &RuleSet_classicalT {type: http, behavior: classical, interval: 43200, format: text, proxy: 手动切换}
RuleSet_classicalY: &RuleSet_classicalY {type: http, behavior: classical, interval: 43200, format: yaml, proxy: 手动切换}
RuleSet_domainT: &RuleSet_domainT {type: http, behavior: domain, interval: 43200, format: text, proxy: 手动切换}
RuleSet_domainY: &RuleSet_domainY {type: http, behavior: domain, interval: 43200, format: yaml, proxy: 手动切换}
RuleSet_ipcidr: &RuleSet_ipcidr {type: http, behavior: ipcidr, interval: 43200, format: text, proxy: 手动切换}

# 订阅规则
rule-providers:
# 拦截类规则
  sogouinput: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/sogouinput.txt}
  AWAvenue-Ads-Rule: {<<: *RuleSet_domainY, url: https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml, path: ./Rules/AWAvenue-Ads-Rule/AWAvenue-Ads-Rule-Clash.yaml}
  Adobe跟踪&SDK打点: {<<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/reject-drop.txt, path: ./Rules/sukkaw_ruleset/reject_non_ip_drop.txt}
  视频QUIC&PCDN: {<<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/reject-no-drop.txt, path: ./Rules/sukkaw_ruleset/reject_non_ip_no_drop.txt}

# 常见静态 CDN
  常见静态CDN域名集: { <<: *RuleSet_domainT, url: https://ruleset.skk.moe/Clash/domainset/cdn.txt, path: ./Rules/sukkaw_ruleset/cdn_domainset.txt }
  常见静态CDN非IP: { <<: *RuleSet_domainT, url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt, path: ./Rules/sukkaw_ruleset/cdn_non_ip.txt }

# 流媒体服务
  Netflix: { <<: *RuleSet_classicalY, url: "https://raw.githubusercontent.com/dler-io/Rules/main/Clash/Provider/Media/Netflix.yaml", path: "./rules/Netflix.yaml" }
  流媒体非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/stream.txt, path: ./Rules/sukkaw_ruleset/stream_non_ip.txt }
  AI服务非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/ai.txt, path: ./Rules/sukkaw_ruleset/ai_non_ip.txt }

# 即时通讯
  Telegram: { <<: *RuleSet_classicalT, url: https://github.com/LucaLin233/Luca_Conf/raw/main/Surge/Rule/Telegram.list, path: ./Rules/Telegram.txt }

# 人工智能 
  人工智能非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/ai.txt, path: ./Rules/sukkaw_ruleset/ai_non_ip.txt }

# 苹果服务
  苹果CDN域名集: { <<: *RuleSet_domainT, url: https://ruleset.skk.moe/Clash/domainset/apple_cdn.txt, path: ./Rules/sukkaw_ruleset/apple_cdn.txt }
  苹果服务非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/apple_services.txt, path: ./Rules/sukkaw_ruleset/apple_services.txt }
  苹果中国非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt, path: ./Rules/sukkaw_ruleset/apple_cn_non_ip.txt }

# 微软服务
  微软CDN非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt, path: ./Rules/sukkaw_ruleset/microsoft_cdn_non_ip.txt }
  微软服务非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/microsoft.txt, path: ./Rules/sukkaw_ruleset/microsoft_non_ip.txt }

# 下载服务
  下载域名集: { <<: *RuleSet_domainT, url: https://ruleset.skk.moe/Clash/domainset/download.txt, path: ./Rules/sukkaw_ruleset/download_domainset.txt }
  下载非IP: { <<: *RuleSet_domainT, url: https://ruleset.skk.moe/Clash/non_ip/download.txt, path: ./Rules/sukkaw_ruleset/download_non_ip.txt }

# 网络区域
  内网非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/lan.txt, path: ./Rules/sukkaw_ruleset/lan_non_ip.txt }
  国内域名非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/domestic.txt, path: ./Rules/sukkaw_ruleset/domestic_non_ip.txt }
  直连非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/direct.txt, path: ./Rules/sukkaw_ruleset/direct_non_ip.txt }
  全球非IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/non_ip/global.txt, path: ./Rules/sukkaw_ruleset/global_non_ip.txt } 

### IP 类规则
  流媒体IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/ip/stream.txt, path: ./Rules/sukkaw_ruleset/stream_ip.txt }
  内网IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/ip/lan.txt, path: ./Rules/sukkaw_ruleset/lan_ip.txt }
  国内IP: { <<: *RuleSet_classicalT, url: https://ruleset.skk.moe/Clash/ip/domestic.txt, path: ./Rules/sukkaw_ruleset/domestic_ip.txt }
  中国IP段: { <<: *RuleSet_ipcidr, url: https://ruleset.skk.moe/Clash/ip/china_ip.txt, path: ./Rules/sukkaw_ruleset/china_ip.txt }


# 分流规则
rules:
# 自定义规则
## 您可以在此处插入自定义规则
  - DOMAIN-SUFFIX,zoom.us,国外网站
  - DOMAIN-KEYWORD,todesk,DIRECT
  - DOMAIN-KEYWORD,AnyViewer,DIRECT
  - DOMAIN-KEYWORD,DeepL,DIRECT

### 非 IP 类规则
  - RULE-SET,sogouinput,REJECT
  - RULE-SET,AWAvenue-Ads-Rule,REJECT
  - RULE-SET,Adobe跟踪&SDK打点,REJECT-DROP
  - RULE-SET,视频QUIC&PCDN,REJECT
  - RULE-SET,常见静态CDN域名集,手动切换
  - RULE-SET,常见静态CDN非IP,手动切换
  - RULE-SET,Netflix,Netflix
  - RULE-SET,流媒体非IP,美国节点
  - RULE-SET,Telegram,Telegram
  - RULE-SET,苹果CDN域名集,DIRECT
  - RULE-SET,下载域名集,手动切换
  - RULE-SET,下载非IP,手动切换
  - RULE-SET,苹果服务非IP,Apple Service
  - RULE-SET,苹果中国非IP,DIRECT
  - RULE-SET,微软CDN非IP,DIRECT
  - RULE-SET,微软服务非IP,DIRECT
  - RULE-SET,人工智能非IP,AI
  - RULE-SET,全球非IP,国外网站
  - RULE-SET,内网非IP,DIRECT
  - RULE-SET,国内域名非IP,DIRECT
  - RULE-SET,直连非IP,DIRECT

### IP 类规则
  - RULE-SET,流媒体IP,美国节点
  - RULE-SET,内网IP,DIRECT
  - RULE-SET,国内IP,DIRECT
  - RULE-SET,中国IP段,DIRECT

### 其他 类规则
  - GEOIP,CN,DIRECT
  - MATCH,漏网之鱼

url-rewrite:
# Google Redirect
  - ^https?://(www.)?(g|google)\.cn https://www.google.com 307
# AbeamTV Unlock
  - ^https?://api\.abema\.io/v\d/ip/check - reject
# JD Protection
  - ^https?://union\.click\.jd\.com/jda? http://union.click.jd.com/jda?adblock= header
  - ^https?://union\.click\.jd\.com/sem.php? http://union.click.jd.com/sem.php?adblock= header
